# Application
spring.application.name=appointment_system

# Server
server.port=8080

# MySQL Database Configuration
spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:appointment_system}?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&characterEncoding=UTF-8
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:Cqian1231}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP Connection Pool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=AppointmentHikariPool

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true

# Redis Configuration
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=0

# Session Configuration (Redis)
spring.session.store-type=redis
spring.session.redis.namespace=appointment:session
spring.session.timeout=4h

# RabbitMQ Configuration
spring.rabbitmq.host=${RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${RABBITMQ_PORT:5672}
spring.rabbitmq.username=${RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${RABBITMQ_PASSWORD:guest}

# Actuator Endpoints
management.endpoints.web.exposure.include=health,info,prometheus,metrics,loggers,env,beans,mappings
management.endpoint.health.show-details=when_authorized
management.endpoint.health.probes.enabled=true
management.endpoint.prometheus.enabled=true
management.endpoint.metrics.enabled=true

# Prometheus Metrics Export
management.prometheus.metrics.export.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.9,0.95,0.99
management.metrics.distribution.slo.http.server.requests=100ms,200ms,500ms,1s,2s
management.metrics.web.server.request.autotime.enabled=true
management.metrics.web.server.request.autotime.percentiles=0.5,0.9,0.95,0.99
management.metrics.tags.application=appointment_system

# JVM Metrics
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true

# DataSource Metrics
management.metrics.enable.hikari=true

# Custom Metrics Configuration
app.metrics.booking.enabled=true
app.metrics.user.enabled=true
app.metrics.merchant.enabled=true

# OpenAPI / Swagger Configuration
springdoc.api-docs.path=/api-docs
springdoc.api-docs.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.doc-expansion=list
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.default-models-expand-depth=1
springdoc.packages-to-scan=org.example.appointment_system.controller
springdoc.paths-to-match=/api/**
springdoc.show-actuator=false
springdoc.model-and-view-allowed=true

# Logging
logging.level.org.example.appointment_system=DEBUG
logging.level.org.springframework.security=INFO
logging.level.org.hibernate.SQL=DEBUG

# Logging File Configuration (for logback-spring.xml)
logging.file.path=${LOG_PATH:logs}
logging.file.name=${LOG_PATH:logs}/appointment_system.log

# Request Logging Filter
app.logging.request-logging.enabled=${REQUEST_LOGGING_ENABLED:true}
app.logging.request-logging.include-payload=${REQUEST_LOGGING_INCLUDE_PAYLOAD:false}
app.logging.request-logging.max-payload-length=${REQUEST_LOGGING_MAX_PAYLOAD:1000}

# Signed Link Configuration
app.signed-link.secret=${SIGNED_LINK_SECRET:your-secret-key-at-least-32-characters-long}
app.signed-link.expiration-hours=${SIGNED_LINK_EXPIRATION_HOURS:72}

# Rate Limiting Configuration
# For development, set RATE_LIMIT_ENABLED=false to disable rate limiting
app.rate-limit.enabled=${RATE_LIMIT_ENABLED:false}
app.rate-limit.default-per-minute=${RATE_LIMIT_DEFAULT_PER_MINUTE:60}
app.rate-limit.authenticated-per-minute=${RATE_LIMIT_AUTH_PER_MINUTE:120}
app.rate-limit.auth-endpoint-per-minute=${RATE_LIMIT_AUTH_ENDPOINT_PER_MINUTE:10}

# Cache Configuration
spring.cache.type=redis
spring.cache.redis.key-prefix=appointment:cache:
spring.cache.redis.cache-null-values=false

# Jackson Configuration
spring.jackson.default-property-inclusion=non_null
spring.jackson.deserialization.fail-on-unknown-properties=false

# ============================================
# Nacos 配置中心（可选功能）
# ============================================
# 启用 Nacos 配置中心（设置为 false 使用本地配置）
spring.cloud.nacos.config.enabled=${NACOS_CONFIG_ENABLED:false}

# 服务注册与发现（可选，设置为 false 禁用）
spring.cloud.nacos.discovery.enabled=${NACOS_DISCOVERY_ENABLED:false}
