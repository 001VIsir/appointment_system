# ============================================
# Nacos 配置示例 - 生产环境 (prod)
# ============================================
# 导入方式：在 Nacos 控制台 -> 配置管理 -> 导入配置
# 选择此文件即可导入

# Application
spring.application.name=appointment_system

# Server
server.port=8080

# MySQL Database Configuration
# 注意：生产环境建议使用连接池、SSL、读写分离等高级配置
spring.datasource.url=jdbc:mysql://mysql-prod:3306/appointment_system?useSSL=true&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=false&characterEncoding=UTF-8&useUnicode=true
spring.datasource.username=prod_user
spring.datasource.password=${DB_PASSWORD}

# HikariCP Connection Pool (生产环境优化)
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=AppointmentHikariPool
spring.datasource.hikari.auto-commit=false

# JPA / Hibernate (生产环境关闭SQL输出)
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false

# Redis Configuration (生产环境建议使用集群或哨兵模式)
spring.data.redis.host=${REDIS_HOST:redis-prod}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=0
# 生产环境建议配置连接池参数
spring.data.redis.lettuce.pool.max-active=50
spring.data.redis.lettuce.pool.max-idle=20
spring.data.redis.lettuce.pool.min-idle=5

# Session Configuration (Redis)
spring.session.store-type=redis
spring.session.redis.namespace=appointment:session
spring.session.timeout=2h
spring.session.redis.flush-mode=on_save

# Nacos Configuration
spring.cloud.nacos.config.enabled=true
spring.cloud.nacos.discovery.enabled=true
spring.cloud.nacos.config.server-addr=${NACOS_SERVER_ADDR:nacos-prod:8848}
spring.cloud.nacos.discovery.server-addr=${NACOS_SERVER_ADDR:nacos-prod:8848}
spring.cloud.nacos.config.namespace=prod
spring.cloud.nacos.discovery.namespace=prod

# Actuator (生产环境限制暴露端点)
management.endpoints.web.exposure.include=health,prometheus,metrics
management.endpoint.health.show-details=never
management.endpoint.health.probes.enabled=true
management.endpoint.prometheus.enabled=true
management.endpoint.metrics.enabled=true

# Prometheus Metrics Export
management.prometheus.metrics.export.enabled=true

# Logging (生产环境只记录重要日志)
logging.level.org.example.appointment_system=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate=WARN

# Rate Limiting (生产环境开启)
app.rate-limit.enabled=true
app.rate-limit.default-per-minute=60
app.rate-limit.authenticated-per-minute=120
app.rate-limit.auth-endpoint-per-minute=10

# Request Logging
app.logging.request-logging.enabled=true
app.logging.request-logging.include-payload=false

# Cache Configuration
spring.cache.type=redis
spring.cache.redis.key-prefix=appointment:cache:
spring.cache.redis.cache-null-values=false
spring.cache.redis.time-to-live=600000
