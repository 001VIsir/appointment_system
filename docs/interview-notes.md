# 项目介绍（面试视角）

## 一句话概述

这是一个面向 ToC 的预约服务平台，前后端分离，支持三类用户（管理员、商户、普通用户），提供预约任务创建、短期签名链接预约、统计分析与 Redis Session 的完整闭环。

---

## 1. 项目背景与目标

- **目标**：为商户提供可配置的预约任务，普通用户使用签名链接即可预约，管理员统一监管与统计。
- **约束**：高并发预约下的数据一致性、可扩展的权限体系、可被第三方前端接入的 API 能力。

---

## 2. 我负责的核心工作（面试视角）

### 1) 整体架构与模块划分
- 前端（Vue 3 + TypeScript + Element Plus）与后端（Spring Boot REST）分离。
- 三层角色权限（管理员 / 商户 / 普通用户）。

### 2) 预约任务体系设计
- 设计"父任务 + 子任务（时段）"的模型，商户创建后基于 taskId 管理。
- 对外提供短期签名链接（Signed Link）用于用户访问。
- 管理员统一统计和监管。

### 3) 高并发一致性与安全
- 预约子任务使用乐观锁，避免超卖。
- Redis 做 Session 与限流（429）
- 关键接口权限验证严格区分角色。

### 4) 监控与可运营
- 提供管理员接口统计：调用量、错误率、平均耗时。
- 统计模块支持商户与全局视角。

---

## 3. 技术栈与关键选型理由

| 技术 | 选型理由 |
|------|----------|
| **Vue 3 + TypeScript** |  Composition API，类型安全，开发体验好 |
| **Element Plus** | 组件丰富，文档完善 |
| **Spring Boot + JPA** | 快速开发与 ORM 数据一致性保障 |
| **Redis Session** | 多实例部署下会话一致 |
| **Redis 限流** | 避免 API 被恶意或高频调用拖垮 |
| **RabbitMQ** | 异步消息处理，削峰填谷 |
| **Flyway** | 数据库迁移管理 |

---

## 4. 数据库设计与核心表

| 表名 | 说明 |
|------|------|
| `users` | 用户基础信息 + 角色 |
| `merchant_profiles` | 商户资料与会话超时配置 |
| `service_items` | 服务项目（商户提供的服务） |
| `appointment_tasks` | 预约父任务（按日期） |
| `appointment_slots` | 预约子任务（时段） |
| `bookings` | 用户预约记录（含乐观锁版本号） |

---

## 5. 高并发与一致性处理（重点）

### 乐观锁
- 预约表使用 `version` 字段实现乐观锁
- 并发预约时，版本号冲突会抛出异常，保证数据一致性

### 限流
- 基于 Redis 计数器实现接口限流
- 支持区分认证/未认证用户配置
- 超限返回 429 状态码

### 缓存
- 商户信息、服务项列表等使用 Spring Cache 缓存
- 预约时段实时查询，不缓存

---

## 6. 安全与权限控制（重点）

### 会话管理
- 使用 Spring Session + Redis 存储会话
- 支持分布式部署下的会话共享

### 角色权限
| 角色 | 权限 |
|------|------|
| 普通用户 | 预约、查看自己的预约记录 |
| 商户 | 管理自己的服务项目、预约任务、查看统计 |
| 管理员 | 全平台统计、用户管理 |

### 密码安全
- 使用 BCrypt 加密存储

### 签名链接
- HMAC-SHA256 签名算法
- 包含过期时间，防止链接被长期滥用

---

## 7. 系统亮点

- **短期签名链接**：替代长期可分享链接，降低泄露风险，过期自动失效
- **可被第三方前端接入**：提供标准 REST API + CORS 配置，商户可自建前端
- **可观测性**：支持调用统计接口，方便运营与问题定位
- **乐观锁防超卖**：高并发预约场景下的数据一致性保障

---

## 8. 项目难点与解决方案

### 1) 高并发下预约超卖问题
- **解决方案**：乐观锁 + 数据库事务，版本号冲突时重试或返回友好提示

### 2) 跨域与第三方接入
- **解决方案**：允许配置 CORS 白名单，并强制 `withCredentials`

### 3) 接口安全与权限控制
- **解决方案**：Spring Security + Method PreAuthorize 分层校验

### 4) Session 共享
- **解决方案**：Redis Session，支持多实例部署

---

## 9. 面试官可提问的方向（引导）

- 签名链接的安全性：过期策略、签名算法、重放风险
- 限流如何扩展成多维度（IP/用户/任务）？
- Session 模式与 JWT 的取舍？为什么目前用 Session？
- 统计接口如何做到实时聚合？
- 乐观锁的实现细节和失败重试策略

---

## 10. 下一步可扩展方向

- 接入消息队列做异步预约与削峰
- 增加 API 版本控制，支持平滑升级
- 提供 SDK（Java/Node）简化第三方接入
- 对外提供 Prometheus 指标输出
- 数据库读写分离

---

## 11. 快速运行（对外介绍版本）

```bash
# 后端
./mvnw spring-boot:run

# 前端
cd frontend
npm install
npm run dev

# API Base：http://localhost:8080/api
```
