# 项目介绍（面试视角）

## 一句话概述
这是一个面向 ToC 的预约服务平台，前后端分离，支持三类用户（管理员、商户、普通用户），提供预约任务创建、短期签名链接预约、统计分析与 Redis Session 的完整闭环。

---

## 1. 项目背景与目标
- 目标：为商户提供可配置的预约任务，普通用户使用签名链接即可预约，管理员统一监管与统计。
- 约束：高并发预约下的数据一致性、可扩展的权限体系、可被第三方前端接入的 API 能力。

---

## 2. 我负责的核心工作（面试视角）
1) **整体架构与模块划分**
- 前端（React + React Query + Zustand）与后端（Spring Boot REST）分离。
- 三层角色权限（管理员 / 商户 / 普通用户）。

2) **预约任务体系设计**
- 设计“父任务 + 子任务（时段/桌号等）”的模型，商户创建后基于 taskId 管理。
- 对外提供短期签名链接（Signed Link）用于用户访问。
- 管理员统一统计和监管。

3) **高并发一致性与安全**
- 预约子任务使用乐观锁，避免超卖。
- Redis 做 Session 与限流（429）
- 关键接口权限验证严格区分角色。

4) **监控与可运营**
- 提供管理员接口统计：调用量、错误率、平均耗时。
- 统计模块支持商户与全局视角。

---

## 3. 技术栈与关键选型理由
- **React + React Query**：解决状态管理与数据请求的一致性问题。
- **Spring Boot + JPA**：快速开发与 ORM 数据一致性保障。
- **Redis Session**：多实例部署下会话一致。
- **Redis 限流**：避免 API 被恶意或高频调用拖垮。

---

## 4. 数据库设计与核心表
- `users`：用户基础信息 + 角色。
- `merchants`：商户资料与会话超时配置。
- `appointment_tasks`：预约父任务。
- `appointment_slots`：预约子任务（时段/桌号）。
- `appointment_bookings`：用户预约记录。

---

## 5. 高并发与一致性处理（重点）
- 预约接口：利用 **乐观锁**（version）字段防止并发超卖。
- API 限流：Redis 计数器控制，过载返回 429。
- 任务查询：可短缓存降低压力。

---

## 6. 安全与权限控制（重点）
- 会话统一用 Redis Session。
- 角色控制：
  - 普通用户只允许预约与查看自己的记录。
  - 商户只能管理自己的任务。
  - 管理员查看全量统计。
- 密码使用 BCrypt 加密。

---

## 7. 系统亮点
- **短期签名链接**：替代长期可分享链接，降低泄露风险。
- **可被第三方前端接入**：提供标准 REST API + CORS 配置，商户可自建前端。
- **可观测性**：支持调用统计接口，方便运营与问题定位。

---

## 8. 项目难点与解决方案
1) **高并发下预约超卖问题**
- 通过乐观锁 + 事务保证一致性。

2) **跨域与第三方接入**
- 允许配置 CORS 白名单，并强制 `withCredentials`。

3) **接口安全与权限控制**
- Spring Security + Method PreAuthorize 分层校验。

---

## 9. 面试官可提问的方向（引导）
- 签名链接的安全性：过期策略、签名算法、重放风险。
- 限流如何扩展成多维度（IP/用户/任务）？
- Session 模式与 JWT 的取舍？为什么目前用 Session？
- 统计接口如何做到实时聚合？

---

## 10. 下一步可扩展方向
- 接入消息队列做异步预约与削峰。
- 增加 API 版本控制，支持平滑升级。
- 提供 SDK（Java/Node）简化第三方接入。
- 对外提供 Prometheus 指标输出。

---

## 11. 快速运行（对外介绍版本）
- 后端：`mvnw spring-boot:run`
- 前端：`cd frontend && npm install && npm run dev`
- API Base：`http://localhost:8080/api`
