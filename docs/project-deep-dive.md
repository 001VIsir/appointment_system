# 深度项目讲解（新同学/面试官视角）

- Prometheus 指标输出
- SDK 提供（Java/Node）
- API 版本控制
- 消息队列削峰
## 9. 可扩展方向

---

- Spring Security + 方法级权限
3) **权限划分与治理**

- 短期签名 + 过期策略
2) **外部访问安全**

- 数据库锁 + 事务保证
1) **高并发预约一致性**
## 8. 项目难点与解决方案

---

- **第三方接入友好**：REST + CORS 白名单
- **可观测性**：统计接口直观监控
- **强一致预约**：高并发下不超卖
- **短期签名链接**：兼顾安全与易用
## 7. 项目亮点

---

- Session 存 Redis，避免多实例失效
- 密码 BCrypt 加密
  - 管理员：全局统计
  - 商户：任务管理
  - 普通用户：预约/查看
- 角色权限严格区分：
## 6. 安全与权限控制

---

- 监控接口：统计调用量/错误率/平均耗时
- 客户端建议短缓存（降低查询压力）
- Redis 限流（超限返回 429）
## 5. 高并发与稳定性设计

---

- 采用锁 + 事务保证一致性
- 高并发下容易超卖
难点：

- 成功后写入预约记录
- 校验容量 & 防止重复预约
- 使用数据库锁（`findByIdForUpdate`）
### 4.4 预约下单（并发一致性）

---

- OAuth2：标准但成本高
- JWT：失效难、管理复杂
- 长期 token：泄露风险高，需黑名单
替代方案缺点：

- 比长期 token 更安全
- 泄露风险低（短期有效）
好处：

- 过期即失效
- 服务端校验签名与过期时间
- 生成 `taskId + 过期时间 + HMAC` 的签名
方式：

- 允许外部用户访问任务，但避免长期暴露
- 支持商户自建前端/小程序
目的：
### 4.3 签名链接访问（核心亮点）

---

- 业务中通常“创建后不允许修改”，避免一致性问题
- 任务结构变化会影响已有预约
难点：

- 子任务可以定义容量、位置
- 创建子任务并校验必须落在父任务范围内
- 创建父任务并校验时间范围
### 4.2 商户创建任务

---

- 续签方案复杂
- 难以即时撤销
JWT 缺点：

- 商户可配置会话时长
- Session 更适合可控退出与动态超时
为什么不用 JWT：

- Session 存入 Redis，可支持多实例部署
- 后端认证成功后写入 Session
- 用户提交账号密码
### 4.1 登录流程（Session + Redis）

## 4. 关键流程原理

---

- 统计口径统一（按任务/按子项/按商户）
- 结构清晰、扩展性高（场景+子项）
设计原因：

用户对某个子任务的预约记录。
### 3.3 预约记录（appointment_bookings）

任务下的具体预约单元，例如时间段/桌号/名额。
### 3.2 子任务（appointment_slots）

代表一个可预约“场景”，例如景区、健身房、餐饮店等。
### 3.1 父任务（appointment_tasks）
## 3. 核心业务模型

---

- 管理员 -> 看统计/全量任务
- 用户登录 -> 用签名链接访问任务 -> 下单预约
- 商户登录 -> 创建任务 -> 生成签名链接
访问路径：

- 缓存/会话：Redis（Session + 限流 + 统计缓存）
- 数据库：MySQL 8（核心业务数据）
- 后端：Spring Boot REST API（业务核心）
- 前端：React（页面与交互）
## 2. 架构总览（从 0 开始理解）

---

这是一个 ToC 预约平台：商户创建预约任务，用户通过短期签名链接预约，管理员统一监管与统计。
## 1. 项目一句话


