# 技术深挖版 Q&A（面试追问用）

## Q1：为什么不用长期 token？
**答**：长期 token 一旦泄露难以控制，只能靠过期或黑名单。我们用短期签名链接（taskId + 过期时间 + HMAC），过期即失效，风险更可控。

## Q2：签名链接会不会被伪造？
**答**：签名基于 HMAC SHA256，只有服务端持有密钥。校验时同时验证签名与过期时间，伪造成本极高。

## Q3：为什么不用 JWT？
**答**：Session 可以动态配置会话时长、支持即时注销；JWT 一旦发出撤销困难。商户业务需要灵活控制会话，所以选 Session + Redis。

## Q4：预约高并发怎么防止超卖？
**答**：子任务查询使用行级锁（`findByIdForUpdate`），同时校验容量与重复预约，在事务中完成写入，保证一致性。

## Q5：为什么不直接用分布式锁？
**答**：当前规模下数据库锁更简单可靠，分布式锁成本更高且引入复杂度。后续可扩展到 Redis 分布式锁或消息队列。

## Q6：如何支撑第三方前端接入？
**答**：提供 REST API + CORS 白名单；商户自建前端通过登录态访问任务，用户通过签名链接访问任务。

## Q7：限流策略怎么做？
**答**：基于 Redis 计数器，固定窗口限流。超限返回 429，并携带 `X-RateLimit-*` 信息。

## Q8：统计数据如何获取？
**答**：提供管理员与商户统计接口，支持订单量、用户量等指标，必要时可加缓存降低压力。

## Q9：签名链接过期后怎么办？
**答**：商户重新生成即可，属于短期访问凭证设计。

## Q10：如何保证系统可扩展？
**答**：模块化 REST API，统计/预约/任务模块独立；可进一步引入消息队列、API 版本控制、指标监控系统。


